<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rural Essentials</title>
  <style>
    :root{
      --bg:#0e1a1a;--card:#122222;--muted:#1a2d2d;--text:#ecf7f6;--sub:#b9d7d5;--accent:#39d0c7;--accent-2:#2ab3ab;--danger:#f25f5c;
      --shadow:0 10px 25px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.04);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif;color:var(--text);background:radial-gradient(1200px 600px at 20% -10%,rgba(57,208,199,.15),transparent 50%), radial-gradient(900px 400px at 100% 0,rgba(57,208,199,.12),transparent 60%), var(--bg);}  
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    /* Navbar */
    header{position:sticky;top:0;z-index:50;background:rgba(14,26,26,.85);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand .logo{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),#7ff);color:#003836;box-shadow:var(--shadow)}
    .links{display:flex;gap:16px;flex-wrap:wrap}
    .links a{padding:10px 12px;border-radius:12px}
    .links a:hover{background:var(--muted)}
    .auth-buttons{display:flex;gap:10px}
    .btn{background:var(--accent);color:#003836;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;box-shadow:var(--shadow)}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.12)}
    .btn.danger{background:var(--danger);color:white}
    /* Hero */
    .hero{padding:48px 0 16px}
    .hero-inner{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center}
    .hero h1{font-size:clamp(26px,4vw,42px);line-height:1.1;margin:0 0 12px}
    .hero p{color:var(--sub);margin:0 0 18px}
    .card{background:var(--card);border-radius:18px;padding:18px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.06)}
    .grid{display:grid;gap:16px}
    /* Sections */
    section{padding:28px 0}
    h2{font-size:clamp(20px,3vw,28px);margin:0 0 14px}
    .sub{color:var(--sub);font-size:14px;margin-bottom:12px}
    /* Services */
    .services{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    .service{display:flex;gap:12px;align-items:center;padding:14px;border-radius:16px;background:var(--muted);border:1px solid rgba(255,255,255,.06)}
    .service .icon{font-size:22px}
    /* Products */
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .input{flex:1;min-width:220px;background:var(--muted);border:1px solid rgba(255,255,255,.08);color:var(--text);padding:10px 12px;border-radius:12px}
    .products{grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}
    .product{display:grid;gap:10px}
    .product .price{font-weight:700;color:#aff}
    .product img{border-radius:14px;border:1px solid rgba(255,255,255,.06)}
    /* News */
    .news-list{display:grid;gap:10px}
    .news-item{padding:12px 14px;border-radius:14px;background:var(--muted);border:1px solid rgba(255,255,255,.06)}
    /* Contact */
    form{display:grid;gap:10px}
    textarea.input{min-height:110px;resize:vertical}
    /* Dashboard */
    .hidden{display:none !important}
    .dashboard-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .booking-item{display:flex;justify-content:space-between;padding:10px;border-radius:12px;background:var(--muted);border:1px solid rgba(255,255,255,.06)}
    /* Cart */
    .cart{position:fixed;right:18px;bottom:18px;z-index:60}
    .cart-panel{position:fixed;right:18px;bottom:70px;width:min(380px,94vw)}
    .cart-toggle{border-radius:20px}
    .cart-list{max-height:50vh;overflow:auto;display:grid;gap:8px}
    .cart-row{display:flex;justify-content:space-between;align-items:center;gap:10px;background:var(--muted);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08)}
    .qty{display:flex;align-items:center;gap:8px}
    .qty button{padding:6px 10px}
    .total{display:flex;justify-content:space-between;font-weight:800}
    footer{color:var(--sub);padding:40px 0;text-align:center}

    /* Responsive */
    @media (max-width: 860px){
      .hero-inner{grid-template-columns:1fr}
      .dashboard-grid{grid-template-columns:1fr}
      .links{display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><div class="logo">ðŸšœ</div> Rural Essentials</div>
      <nav class="links">
        <a href="#home">Home</a>
        <a href="#services">Services</a>
        <a href="#products">Products</a>
        <a href="#news">News</a>
        <a href="#contact">Contact</a>
      </nav>
      <div class="auth-buttons" id="authArea">
        <button class="btn ghost" onclick="openModal('loginModal')">Login</button>
        <button class="btn" onclick="openModal('registerModal')">Sign up</button>
      </div>
    </div>
  </header>

  <main id="home">
    <div class="container hero">
      <div class="hero-inner">
        <div>
          <h1>Everyday essentials, delivered with care.</h1>
          <p>Find groceries, medicines, dairy, and more. Built for rural communities with reliable service and fair prices.</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn" href="#products">Browse Products</a>
            <a class="btn ghost" href="#services">See Services</a>
          </div>
        </div>
        <div class="card">
          <strong>Helpline:</strong> 1800-123-9000<br/>
          <div class="sub">Service hours: 7:00 AM â€“ 9:00 PM</div>
          <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px">
            <div class="card" style="text-align:center">
              <div style="font-size:28px">ðŸ›’</div>
              <div class="sub">Grocery</div>
            </div>
            <div class="card" style="text-align:center">
              <div style="font-size:28px">ðŸ¥›</div>
              <div class="sub">Dairy</div>
            </div>
            <div class="card" style="text-align:center">
              <div style="font-size:28px">ðŸ’Š</div>
              <div class="sub">Medicines</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section id="services">
      <div class="container">
        <h2>Our Services</h2>
        <p class="sub">Doorstep delivery, easy ordering, and community updates.</p>
        <div id="servicesGrid" class="grid services"></div>
      </div>
    </section>

    <section id="products">
      <div class="container">
        <h2>Available Products</h2>
        <div class="toolbar">
          <input id="search" class="input" placeholder="Search products... (e.g., rice, milk)"/>
          <button class="btn" onclick="refreshProducts()">Search</button>
        </div>
        <div id="productsGrid" class="grid products"></div>
      </div>
    </section>

    <section id="news">
      <div class="container">
        <h2>News & Updates</h2>
        <p class="sub">Community notices and essential information.</p>
        <div id="newsList" class="news-list"></div>
      </div>
    </section>

    <section id="contact">
      <div class="container">
        <h2>Contact Us</h2>
        <div class="grid" style="grid-template-columns:1.2fr .8fr">
          <div class="card">
            <form id="contactForm">
              <input class="input" name="name" placeholder="Your name" required />
              <textarea class="input" name="message" placeholder="Message" required></textarea>
              <button class="btn" type="submit">Send</button>
              <div id="contactStatus" class="sub"></div>
            </form>
          </div>
          <div class="card">
            <strong>Address</strong><br/>
            Gram Sewa Kendra, Near Panchayat Bhawan, Village A, District B, State C â€“ 000000<br/>
            <div style="height:10px"></div>
            <strong>Helpline:</strong> 1800-123-9000<br/>
            <strong>Email:</strong> support@ruralessentials.local
          </div>
        </div>
      </div>
    </section>

    <section id="dashboard" class="hidden">
      <div class="container">
        <h2>My Dashboard</h2>
        <div class="dashboard-grid">
          <div class="card">
            <h3 style="margin-top:0">Welcome, <span id="welcomeName">User</span> ðŸ‘‹</h3>
            <form id="profileForm">
              <input class="input" id="displayName" placeholder="Display name" required />
              <input class="input" id="phone" placeholder="Phone" />
              <button class="btn" type="submit">Save Profile</button>
              <button type="button" class="btn danger" id="logoutBtn">Logout</button>
              <div id="profileStatus" class="sub"></div>
            </form>
          </div>
          <div class="card">
            <h3 style="margin-top:0">My Bookings</h3>
            <div id="bookingsList" class="grid"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Cart Floating UI -->
  <div class="cart">
    <button class="btn cart-toggle" onclick="toggleCart()">ðŸ§º Cart (<span id="cartCount">0</span>)</button>
    <div class="cart-panel hidden card" id="cartPanel">
      <h3 style="margin-top:0">Your Cart</h3>
      <div id="cartList" class="cart-list"></div>
      <div class="total"><span>Total</span><span id="cartTotal">â‚¹0</span></div>
      <div style="height:8px"></div>
      <button class="btn" onclick="checkout()">Checkout</button>
    </div>
  </div>

  <!-- Auth Modals -->
  <dialog id="loginModal" class="card" style="border:none;max-width:420px;width:92vw">
    <form id="loginForm" method="dialog" class="grid">
      <h3 style="margin:0">Login</h3>
      <input class="input" name="email" type="email" placeholder="Email" required />
      <input class="input" name="password" type="password" placeholder="Password" required />
      <button class="btn" type="submit">Login</button>
      <button class="btn ghost" type="button" onclick="closeModal('loginModal')">Close</button>
      <div id="loginStatus" class="sub"></div>
    </form>
  </dialog>

  <dialog id="registerModal" class="card" style="border:none;max-width:460px;width:92vw">
    <form id="registerForm" method="dialog" class="grid">
      <h3 style="margin:0">Create account</h3>
      <input class="input" name="displayName" placeholder="Full name" />
      <input class="input" name="phone" placeholder="Phone" />
      <input class="input" name="email" type="email" placeholder="Email" required />
      <input class="input" name="password" type="password" placeholder="Password" required />
      <button class="btn" type="submit">Sign up</button>
      <button class="btn ghost" type="button" onclick="closeModal('registerModal')">Close</button>
      <div id="registerStatus" class="sub"></div>
    </form>
  </dialog>

  <footer>
    Â© <span id="year"></span> Rural Essentials â€¢ Built for communities
  </footer>

  <script>
    // ====== CONFIG ======
    const BASE_URL = localStorage.getItem('baseUrl') || 'http://localhost:8080/api';
    // ====== STATE ======
    let services = [];
    let products = [];
    let news = [];
    let cart = JSON.parse(localStorage.getItem('cart')||'[]');
    let auth = JSON.parse(localStorage.getItem('auth')||'null');

    // ====== UTIL ======
    const $ = sel => document.querySelector(sel);
    const el = (tag,cls='') => { const e=document.createElement(tag); if(cls) e.className=cls; return e; };
    const fmt = n => 'â‚¹' + (Number(n).toFixed(2));
    function toast(msg, where){ (where||document.body).dataset.toast=msg; setTimeout(()=>{ (where||document.body).dataset.toast=''; }, 1600); }

    async function api(path, {method='GET', body, authNeeded=false}={}){
      const headers = { 'Content-Type':'application/json' };
      if(authNeeded && auth?.token) headers['Authorization'] = 'Bearer ' + auth.token;
      try{
        const res = await fetch(`${BASE_URL}${path}`, { method, headers, body: body?JSON.stringify(body):undefined });
        if(!res.ok) throw new Error(await res.text());
        return await res.json();
      }catch(err){ console.warn('API fallback for', path, err.message);
        return fallback(path, body); // use static data if backend not up
      }
    }

    function fallback(path, body){
      if(path.startsWith('/services')) return [
        {id:1,name:'Grocery Delivery',icon:'ðŸ›’'},
        {id:2,name:'Medicines',icon:'ðŸ’Š'},
        {id:3,name:'Fresh Vegetables',icon:'ðŸ¥¦'},
        {id:4,name:'Dairy Supply',icon:'ðŸ¥›'},
        {id:5,name:'Home Essentials',icon:'ðŸ§¹'}
      ];
      if(path.startsWith('/products')) return [
        {id:1,name:'Rice (5kg)',price:299,image:'https://placehold.co/320x220?text=Rice'},
        {id:2,name:'Wheat Flour (5kg)',price:279,image:'https://placehold.co/320x220?text=Atta'},
        {id:3,name:'Milk (1L)',price:55,image:'https://placehold.co/320x220?text=Milk'},
        {id:4,name:'Bread',price:35,image:'https://placehold.co/320x220?text=Bread'},
        {id:5,name:'Sugar (1kg)',price:48,image:'https://placehold.co/320x220?text=Sugar'},
        {id:6,name:'Paracetamol (10 tabs)',price:25,image:'https://placehold.co/320x220?text=Med'}
      ];
      if(path.startsWith('/news')) return [
        {id:1,title:'Village health camp this Sunday at 10 AM'},
        {id:2,title:'Weekly mandi prices updated for farmers'},
        {id:3,title:'New water supply timings announced by panchayat'}
      ];
      if(path.startsWith('/auth/register')) { auth={userId:1,email:body.email,displayName:body.displayName||'User',token:'demo-token'}; localStorage.setItem('auth',JSON.stringify(auth)); return auth; }
      if(path.startsWith('/auth/login')) { auth={userId:1,email:body.email,displayName:'User',token:'demo-token'}; localStorage.setItem('auth',JSON.stringify(auth)); return auth; }
      if(path.startsWith('/user/me')) return {id:1,email:auth?.email||'demo@local',displayName:auth?.displayName||'User',phone:'',token:auth?.token};
      if(path.startsWith('/user/profile')) { auth.displayName=body.displayName; localStorage.setItem('auth',JSON.stringify(auth)); return { ...auth, phone: body.phone } }
      if(path==='/bookings' && body?.items){ const bk={id:Date.now(),createdAt:new Date().toISOString(),items: body.items.map(i=>({productId:i.productId,productName:products.find(p=>p.id===i.productId)?.name||'Item',price:products.find(p=>p.id===i.productId)?.price||0,quantity:i.quantity})) }; const prev=JSON.parse(localStorage.getItem('bookings')||'[]'); prev.unshift(bk); localStorage.setItem('bookings',JSON.stringify(prev)); return bk; }
      if(path==='/bookings' && !body){ return JSON.parse(localStorage.getItem('bookings')||'[]'); }
      if(path.startsWith('/contact')) return {ok:true};
      return null;
    }

    // ====== RENDER ======
    function renderServices(){
      const grid = $('#servicesGrid'); grid.innerHTML='';
      services.forEach(s=>{
        const d=el('div','service');
        d.innerHTML=`<div class="icon">${s.icon||'ðŸ“¦'}</div><div>${s.name}</div>`;
        grid.appendChild(d);
      });
    }

    function productCard(p){
      const card=el('div','card product');
      card.innerHTML = `
        <img src="${p.image}" alt="${p.name}" loading="lazy"/>
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <div>
            <div>${p.name}</div>
            <div class="price">${fmt(p.price)}</div>
          </div>
          <button class="btn" onclick='addToCart(${JSON.stringify(p.id)})'>Add</button>
        </div>`;
      return card;
    }

    function renderProducts(){
      const grid = $('#productsGrid'); grid.innerHTML='';
      products.forEach(p=> grid.appendChild(productCard(p)) );
    }

    function renderNews(){
      const list = $('#newsList'); list.innerHTML='';
      news.forEach(n=>{
        const d=el('div','news-item'); d.textContent=n.title; list.appendChild(d);
      });
    }

    // ====== CART ======
    function persistCart(){ localStorage.setItem('cart', JSON.stringify(cart)); updateCartBadge(); }
    function updateCartBadge(){ $('#cartCount').textContent = cart.reduce((a,c)=>a+c.quantity,0); const total = cart.reduce((a,c)=>a + c.quantity * (products.find(p=>p.id===c.productId)?.price||0),0); $('#cartTotal').textContent = fmt(total); renderCartList(); }
    function renderCartList(){ const list=$('#cartList'); list.innerHTML=''; cart.forEach(ci=>{ const p=products.find(p=>p.id===ci.productId)||{name:'Item',price:0}; const row=el('div','cart-row'); row.innerHTML=`<div><strong>${p.name}</strong><div class="sub">${fmt(p.price)}</div></div>`; const qty=el('div','qty'); qty.innerHTML=`<button class="btn ghost" onclick="decQty(${ci.productId})">âˆ’</button><span>${ci.quantity}</span><button class="btn ghost" onclick="incQty(${ci.productId})">+</button>`; const rm=el('button','btn ghost'); rm.textContent='Remove'; rm.onclick=()=>removeFromCart(ci.productId); row.appendChild(qty); row.appendChild(rm); list.appendChild(row); }); }
    function addToCart(productId){ const f=cart.find(c=>c.productId===productId); if(f) f.quantity++; else cart.push({productId,quantity:1}); persistCart(); toast('Added to cart'); }
    function incQty(id){ const f=cart.find(c=>c.productId===id); if(f){f.quantity++; persistCart();} }
    function decQty(id){ const f=cart.find(c=>c.productId===id); if(f){f.quantity=Math.max(1,f.quantity-1); persistCart();} }
    function removeFromCart(id){ cart=cart.filter(c=>c.productId!==id); persistCart(); }
    function toggleCart(){ $('#cartPanel').classList.toggle('hidden'); }

    async function checkout(){
      if(!auth){ openModal('loginModal'); return; }
      if(cart.length===0){ toast('Cart is empty'); return; }
      const items = cart.map(c=>({productId:c.productId, quantity:c.quantity}));
      const order = await api('/bookings',{method:'POST', body:{items}, authNeeded:true});
      if(order){ cart=[]; persistCart(); toast('Booking placed!'); loadBookings(); toggleCart(); }
    }

    // ====== AUTH & PROFILE ======
    function syncAuthUI(){
      const authArea = $('#authArea');
      const dash = $('#dashboard');
      if(auth){ authArea.innerHTML = `<span class="sub">Hi, ${auth.displayName||auth.email}</span> <button class="btn" onclick="goDashboard()">Dashboard</button>`; dash.classList.remove('hidden'); loadProfile(); loadBookings(); } else { authArea.innerHTML = `<button class="btn ghost" onclick="openModal('loginModal')">Login</button><button class="btn" onclick="openModal('registerModal')">Sign up</button>`; dash.classList.add('hidden'); }
      $('#welcomeName').textContent = auth?.displayName || 'User';
    }
    function goDashboard(){ location.hash='#dashboard'; }

    function openModal(id){ const d=$("#"+id); d.showModal(); }
    function closeModal(id){ $("#"+id).close(); }

    $('#loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const fd=new FormData(e.target);
      const res = await api('/auth/login',{method:'POST', body:{email:fd.get('email'),password:fd.get('password')}});
      if(res?.token){ auth=res; localStorage.setItem('auth',JSON.stringify(auth)); $('#loginStatus').textContent='Logged in'; closeModal('loginModal'); syncAuthUI(); }
      else $('#loginStatus').textContent='Login failed';
    });

    $('#registerForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const fd=new FormData(e.target);
      const body={ email:fd.get('email'), password:fd.get('password'), displayName:fd.get('displayName'), phone:fd.get('phone') };
      const res = await api('/auth/register',{method:'POST', body});
      if(res?.token){ auth=res; localStorage.setItem('auth',JSON.stringify(auth)); $('#registerStatus').textContent='Registered'; closeModal('registerModal'); syncAuthUI(); }
      else $('#registerStatus').textContent='Sign up failed';
    });

    $('#logoutBtn').addEventListener('click', ()=>{ auth=null; localStorage.removeItem('auth'); syncAuthUI(); });

    async function loadProfile(){ const me = await api('/user/me',{authNeeded:true}); if(!me) return; $('#displayName').value = me.displayName || ''; $('#phone').value = me.phone || ''; $('#welcomeName').textContent = me.displayName || 'User'; }

    $('#profileForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const body={displayName:$('#displayName').value, phone:$('#phone').value};
      const res = await api('/user/profile',{method:'PUT', body, authNeeded:true});
      $('#profileStatus').textContent = 'Saved!'; auth.displayName = res.displayName; localStorage.setItem('auth',JSON.stringify(auth)); syncAuthUI(); setTimeout(()=>$('#profileStatus').textContent='',1500);
    });

    async function loadBookings(){ const data = await api('/bookings',{authNeeded:true}); const list=$('#bookingsList'); list.innerHTML=''; (data||[]).forEach(b=>{ const div=el('div','booking-item'); const items=(b.items||[]).map(i=>`${i.productName} Ã— ${i.quantity}`).join(', '); div.innerHTML=`<div>Booking #${b.id}<div class="sub">${new Date(b.createdAt).toLocaleString()} â€¢ ${items}</div></div><div></div>`; list.appendChild(div); }); }

    // ====== CONTACT ======
    $('#contactForm').addEventListener('submit', async (e)=>{
      e.preventDefault(); const fd=new FormData(e.target); const body={name:fd.get('name'), message:fd.get('message')};
      const ok = await api('/contact',{method:'POST', body});
      $('#contactStatus').textContent = ok? 'Thanks! We will reach out soon.' : 'Failed. Please try again.';
      e.target.reset(); setTimeout(()=>$('#contactStatus').textContent='',2000);
    });

    // ====== LOADERS ======
    async function refreshServices(){ services = await api('/services'); renderServices(); }
    async function refreshProducts(){ const q=$('#search').value.trim(); products = await api('/products'+(q?`?q=${encodeURIComponent(q)}`:'')); renderProducts(); }
    async function refreshNews(){ news = await api('/news'); renderNews(); }

    // ====== INIT ======
    (function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      refreshServices(); refreshProducts(); refreshNews();
      updateCartBadge(); syncAuthUI();
      // quick keyboard: press ";" to toggle cart
      window.addEventListener('keydown',e=>{ if(e.key===';') toggleCart(); });
    })();
  </script>
</body>
</html>
